{% extends './parts/base.html.twig' %}

{% block title %}Snowtricks
{% endblock %}

{% block body %}

	<div class="container rounded p-4 shadow-lg" style="margin-top:100px;max-width:1000px">
		<div class="text-center">
			{% if trick.images|length > 0 %}
				<img src="{{ asset('assets/tricks/'~trick.images[0].name)}}" class="shadow rounded img-fluid w-100" style="position:relative"/>
			{% endif %}
			<p class="text-pink text-center display-2" style="mix-blend-mode: multiply;position: absolute;top: 30%;left: 50%;transform: translate(-50%, -50%);">{{trick.name}}</p>
		</div>

		<div class="d-flex mt-3 gap-2" style="overflow-x:auto;overflow-y:hidden">
			{% if trick.images|length > 0 %}
				{% for image in trick.images %}
					<a href="{{ asset('assets/tricks/'~image.name)}}" class="glightbox3" data-gallery="gallery1">
						<img src="{{ asset('assets/tricks/'~image.name)}}" class="rounded img-responsive" style="object-fit: cover;height:120px;width:120px;position:relative"/></a>
				{% endfor %}
			{% endif %}

			{% if trick.videos|length > 0 %}
				{% for video in trick.videos %}
					<div class=" embed-responsive embed-responsive-4by3" style="height:120px;max-width:120px;">
						<iframe class="rounded embed-responsive-item" width="120px" height="120px" src="https://www.youtube.com/embed/{{ video.embed | formatYoutube}}" allowfullscreen></iframe>
					</div>
				{% endfor %}
			{% endif %}


		</div>

		<div class="row justify-content-center">
			<div class="col-md-12">
				<p class="mt-5 fs-5 text-pink">Auteur(e) :</p>
				<div class="d-flex align-items-center gap-2">
					<img src="https://i.pravatar.cc/100" class="rounded-circle shadow img-fluid"/>
					<p class="fs-5">{{trick.userId.username|upper}}</p>
				</div>
			</div>
			<div class="col-md-12">
				<p class="mt-5 fs-5 text-pink">Figure :<span class=" text-dark">
						{{trick.name}}</span>
				</p>
				<p class="mt-3 mb-0 fs-5 text-pink">Description</p>
				<p class="mt-0 fs-5">{{trick.description}}</p>
			</div>
		</div>
				<div class="text-center fs-6 mt-5 d-flex justify-content-center flex-wrap" style="column-gap:15px">
			<span>Ajouté le
				{{trick.createdAt | date('d/m/Y')}}
				à
				{{trick.createdAt | date('H\\hi')}}
			</span>
			<span class="d-none d-md-block">
				<i class="fa-solid fa-asterisk"></i>
			</span>
			<span>Modifié le
				{{trick.modifiedAt | date('d/m/Y')}}
				à
				{{trick.modifiedAt | date('H\\hi')}}</span>
		</div>

		<div class="mt-5 mb-5 d-flex gap-2 justify-content-center fs-3">
			{% for cat in trick.category %}
				<span class="badge bg-primary">{{cat.label}}</span>
			{% endfor %}
		</div>

		{% if app.user %}
		<hr/>
		{{ form_start(form) }}
		{{ form_row(form.content) }}
		<button class="mt-4 btn btn-dark shadow" type="submit">Leave a comment</button>
		{{ form_end(form) }}
		{% endif %}
		<hr/>
		<div class="posts">
		</div>
		<div class="mt-5 col-md-12 text-center">
			<button class="btn btn-dark shadow load">Load more</button>
			<i class="fa-2x fa-regular fa-snowflake fa-spin d-none loader"></i>
		</div>
	</div>
{% endblock %}

{% block JS %}
let offset = 0
async function listPosts() {
	document.querySelector('.load').classList.add('d-none')
	document.querySelector('.loader').classList.remove('d-none')
    let response = await fetch('{{ path('app_list_posts', {id: trick.id}) }}/'+offset)
    let data = await response.text()
	document.querySelector('.posts').innerHTML+= data
    offset+=3 
	document.querySelector('.loader').classList.add('d-none')
	document.querySelector('.load').classList.remove('d-none')
}
listPosts()
document.querySelector('.load').addEventListener('click', ()=>{listPosts()})
{% endblock %}
